---
- name: copy current pacman.conf
  ansible.builtin.copy:
    src: /etc/pacman.conf
    dest: /etc/pacman.conf

- name: Run the equivalent of "pacman -Syu" as a separate step
  # Since community.general 5.0.0 the 'changed' state of this call
  # will be 'true' in case the cache was updated, or when a package
  # was updated.
  #
  # The previous behavior was to only indicate whether something was
  # upgraded. To keep the old behavior, add the following to the task:
  #
  #   register: result
  #   changed_when: result.packages | length > 0
  community.general.pacman:
    update_cache: true
    upgrade: true

- name: base packages
  ansible.builtin.package:
    name:
        #- python-pdftotext
        #- unrar
        #- p7zip
        #- catdoc
        #- odt2txt
        #- docx2txt
      - telegram-desktop
      - aws-cli-v2
      - pv
      - diskonaut
      - w3m
      - aerc
      - ntfs-3g
      - cifs-utils
      - lf
      - nfs-utils
      - strace
      - element-desktop
      - nextcloud-client
      - ffmpegthumbnailer
      - rclone
      - nmap
      - restic
      - ueberzug
      - gimp
      - helm
      - atool
      - lynx
      - acpi
      - smartmontools
      - tailscale
      - python-pdftotext
      - mediainfo
      - transmission-cli
      - dnsutils
      - bolt
      - noto-fonts-cjk
      - scrot
      - chromium
      - discord
      - dunst
      - signal-desktop
      - xorg
      - libreoffice-still
      - hunspell
      - hunspell-en_us
      - hunspell-de
      - firefox
      - fwupd
      - glances
      - git
      - gtk2
      - lxappearance
      - neovim
      - numlockx
      - pass
      - pcmanfm
      - pulsemixer
      - rsync
      - sshpass
      - sxhkd
      - sxiv
      - ttf-dejavu
      - ttf-liberation
      - udisks2
      - unclutter
      - wget
      - xclip
      - polybar
      - xdg-user-dirs
      - yubikey-manager
      - zathura
      - zathura-pdf-mupdf
      - zsh
      - zsh-completions
      - ansible
      - mariadb
      - go-tools
      - aws-vault
      - podman
      - podman-compose
      - docker
      - docker-compose
      - fprintd
      - git
      - github-cli
      - gopls
      - jq
      - just
      - kubectl
      - packer
      - pacman-contrib
      - pyenv
      - python-pip
      - ansible-core
      - python-pipenv
      - pyright
      - qemu
      #- terraform
      #- terragrunt
      - tmux
      - vagrant
      - virt-install
      - virt-manager
      - wol
    state: present

- name: WM tools
  ansible.builtin.package:
    name:
      - bspwm
      - dmenu
    state: present

- name: Enable services
  ansible.builtin.systemd:
    name: '{{ item }}'
    enabled: yes
  become: yes
  loop:
    - tailscaled

- name: programming tools
  ansible.builtin.package:
    name:
      - bat
      - bash-language-server
      - shellcheck
    state: latest

- name: virtualization tools
  ansible.builtin.package:
    name:
      #- iptables-nft CONFLICT WITH IPTABLES
      - dnsmasq
      - virtualbox
        #- virtualbox-host-modules-arch ##TRY WITH VIRTUALBOX DISABLED
      - libvirt
      - virt-viewer
      - dmidecode
    state: latest
